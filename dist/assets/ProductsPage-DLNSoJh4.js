import{c as M,f as z,r as n,j as e,X as S,e as R,d as T}from"./index-BbHmWxeT.js";import{H as U}from"./Helmet-BbXNZb2X.js";import{A as B}from"./AdminLayout-BCjfDwtc.js";import{B as E}from"./Button-DmSsJSq7.js";import{u as O}from"./useProducts-CbU5Wv6e.js";import{P as V}from"./plus-CsmrkZlX.js";import{S as G}from"./search--fvj5Q_h.js";import{F as H,S as $}from"./square-pen-BF1IVFps.js";import{E as J}from"./eye-CJmnK4T0.js";import{T as W}from"./trash-2-CACjRIer.js";import{A as X}from"./alert-circle-BQfkHlz4.js";import"./package-RgcQhqxj.js";import"./tag-CJLCSPUx.js";import"./users-CoztkOlz.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=M("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Y=async m=>{const d=await z.createProduct(m);if(d.success&&d.data)return d.data;throw new Error(d.message||"Failed to create product")},_=async(m,d)=>{const x=await z.updateProduct(m,d);if(x.success&&x.data)return x.data;throw new Error(x.message||"Failed to update product")},K=async m=>{const d=await z.deleteProduct(m);if(!d.success)throw new Error(d.message||"Failed to delete product")},A=["Non-Veg Pickles","Veg Pickles","Podulu","Snacks"],Q=({isOpen:m,onClose:d,onSuccess:x})=>{const[a,i]=n.useState(!1),[y,b]=n.useState(null),[k,p]=n.useState(null),[j,u]=n.useState(null),[l,c]=n.useState({name:"",description:"",price:"",category:A[0],stock:"",featured:!1}),N=r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];if(!s.type.startsWith("image/")){u("Please select a valid image file");return}if(s.size>5*1024*1024){u("Image size must be less than 5MB");return}b(s),p(URL.createObjectURL(s)),u(null)}},g=r=>{const{name:s,value:h,type:o}=r.target;c(C=>({...C,[s]:o==="checkbox"?r.target.checked:h})),u(null)},f=r=>new Promise((s,h)=>{const o=new FileReader;o.onload=()=>s(o.result),o.onerror=h,o.readAsDataURL(r)}),P=async r=>{r.preventDefault(),i(!0),u(null);try{if(!l.name.trim())throw new Error("Product name is required");if(!l.description.trim())throw new Error("Product description is required");const s=parseFloat(l.price);if(isNaN(s)||s<=0)throw new Error("Please enter a valid price");const h=parseInt(l.stock);if(isNaN(h)||h<0)throw new Error("Please enter a valid stock quantity");let o="";y&&(o=await f(y)),await Y({name:l.name.trim(),description:l.description.trim(),price:s,image:o,category:l.category,stock:h,featured:l.featured}),c({name:"",description:"",price:"",category:A[0],stock:"",featured:!1}),b(null),p(null),u(null),x(),d()}catch(s){console.error("Error adding product:",s),u(s.message||"Failed to add product. Please try again.")}finally{i(!1)}},v=()=>{a||(u(null),d())};return m?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-secondary-500 bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-serif font-bold text-secondary-500",children:"Add New Product"}),e.jsx("button",{onClick:v,disabled:a,className:"text-neutral-500 hover:text-neutral-700 disabled:opacity-50",children:e.jsx(S,{size:24})})]}),j&&e.jsx("div",{className:"mx-6 mt-4 p-4 bg-error-50 border border-error-200 rounded-md",children:e.jsx("p",{className:"text-error-700 text-sm",children:j})}),e.jsxs("form",{onSubmit:P,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:g,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Category *"}),e.jsx("select",{name:"category",value:l.category,onChange:g,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:a,children:A.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Price (â‚¹) *"}),e.jsx("input",{type:"number",name:"price",value:l.price,onChange:g,step:"0.01",min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Stock *"}),e.jsx("input",{type:"number",name:"stock",value:l.stock,onChange:g,min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:a})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Product Image"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-neutral-300 border-dashed rounded-lg cursor-pointer bg-neutral-50 hover:bg-neutral-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(D,{className:"w-8 h-8 mb-2 text-neutral-500"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"PNG, JPG, JPEG up to 5MB"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:N,disabled:a})]})}),k&&e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsx("img",{src:k,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{b(null),p(null)},disabled:a,className:"absolute -top-2 -right-2 p-1 bg-error-500 text-white rounded-full hover:bg-error-600 disabled:opacity-50",children:e.jsx(S,{size:16})})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Description *"}),e.jsx("textarea",{name:"description",value:l.description,onChange:g,rows:3,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:a})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"featured",checked:l.featured,onChange:g,disabled:a,className:"h-4 w-4 text-primary-500 focus:ring-primary-300 border-neutral-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-neutral-700",children:"Featured Product"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:v,disabled:a,children:"Cancel"}),e.jsx(E,{type:"submit",variant:"primary",disabled:a,children:a?"Adding Product...":"Add Product"})]})]})]})}):null},I=["Non-Veg Pickles","Veg Pickles","Podulu","Snacks"],Z=({isOpen:m,onClose:d,onSuccess:x,product:a})=>{const[i,y]=n.useState(!1),[b,k]=n.useState(null),[p,j]=n.useState(null),[u,l]=n.useState(null),[c,N]=n.useState({name:"",description:"",price:"",category:I[0],stock:"",featured:!1});n.useEffect(()=>{a&&(N({name:a.name,description:a.description||"",price:a.price.toString(),category:a.category,stock:a.stock.toString(),featured:a.featured||!1}),j(a.image))},[a]);const g=r=>{if(r.target.files&&r.target.files[0]){const s=r.target.files[0];if(!s.type.startsWith("image/")){l("Please select a valid image file");return}if(s.size>5*1024*1024){l("Image size must be less than 5MB");return}k(s),j(URL.createObjectURL(s)),l(null)}},f=r=>{const{name:s,value:h,type:o}=r.target;N(C=>({...C,[s]:o==="checkbox"?r.target.checked:h})),l(null)},P=r=>new Promise((s,h)=>{const o=new FileReader;o.onload=()=>s(o.result),o.onerror=h,o.readAsDataURL(r)}),v=async r=>{r.preventDefault(),y(!0),l(null);try{let s=a.image;b&&(s=await P(b)),await _(a.id,{name:c.name,description:c.description,price:parseFloat(c.price),image:s,category:c.category,stock:parseInt(c.stock),featured:c.featured}),x(),d()}catch(s){console.error("Error updating product:",s),l(s.message||"Failed to update product. Please try again.")}finally{y(!1)}};return m?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-secondary-500 bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-serif font-bold text-secondary-500",children:"Edit Product"}),e.jsx("button",{onClick:d,className:"text-neutral-500 hover:text-neutral-700",children:e.jsx(S,{size:24})})]}),u&&e.jsx("div",{className:"mx-6 mt-4 p-4 bg-error-50 border border-error-200 rounded-md",children:e.jsx("p",{className:"text-error-700 text-sm",children:u})}),e.jsxs("form",{onSubmit:v,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Product Name"}),e.jsx("input",{type:"text",name:"name",value:c.name,onChange:f,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Category"}),e.jsx("select",{name:"category",value:c.category,onChange:f,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:i,children:I.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Price (â‚¹)"}),e.jsx("input",{type:"number",name:"price",value:c.price,onChange:f,step:"0.01",min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Stock"}),e.jsx("input",{type:"number",name:"stock",value:c.stock,onChange:f,min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:i})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Product Image"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-neutral-300 border-dashed rounded-lg cursor-pointer bg-neutral-50 hover:bg-neutral-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(D,{className:"w-8 h-8 mb-2 text-neutral-500"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Click to upload or drag and drop"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:g,disabled:i})]})}),p&&e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{k(null),j(a.image)},disabled:i,className:"absolute -top-2 -right-2 p-1 bg-error-500 text-white rounded-full hover:bg-error-600",children:e.jsx(S,{size:16})})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:c.description,onChange:f,rows:3,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:i})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"featured",checked:c.featured,onChange:f,disabled:i,className:"h-4 w-4 text-primary-500 focus:ring-primary-300 border-neutral-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-neutral-700",children:"Featured Product"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:d,disabled:i,children:"Cancel"}),e.jsx(E,{type:"submit",variant:"primary",disabled:i,children:i?"Updating Product...":"Update Product"})]})]})]})}):null},he=()=>{const{user:m}=R(),d=T(),{products:x,loading:a}=O(),[i,y]=n.useState(""),[b,k]=n.useState(!1),[p,j]=n.useState(""),[u,l]=n.useState([]),[c,N]=n.useState(null),[g,f]=n.useState(!1),[P,v]=n.useState(!1),[r,s]=n.useState(null),h=["All",...new Set(x.map(t=>t.category))];n.useEffect(()=>{m&&!m.isAdmin&&d("/")},[m,d]),n.useEffect(()=>{let t=[...x];i&&(t=t.filter(w=>{var F;return w.name.toLowerCase().includes(i.toLowerCase())||((F=w.description)==null?void 0:F.toLowerCase().includes(i.toLowerCase()))})),p&&p!=="All"&&(t=t.filter(w=>w.category===p)),l(t)},[x,i,p]);const o=async t=>{try{await K(t),l(w=>w.filter(F=>F.id!==t)),N(null)}catch(w){console.error("Error deleting product:",w),alert("Failed to delete product. Please try again.")}},C=()=>{window.location.reload()},L=t=>{s(t),v(!0)},q=t=>{window.open(`/products/${t}`,"_blank")};return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx("title",{children:"Manage Products | The Pickle Mom Admin"})}),e.jsxs(B,{children:[e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-4 mb-6",children:e.jsxs(E,{variant:"primary",onClick:()=>f(!0),children:[e.jsx(V,{size:16,className:"mr-2"})," Add New Product"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:i,onChange:t=>y(t.target.value),className:"w-full px-4 py-2 pl-10 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300"}),e.jsx(G,{className:"absolute left-3 top-2.5 text-neutral-400",size:18})]}),e.jsxs("button",{onClick:()=>k(!b),className:"flex items-center justify-center gap-2 px-4 py-2 border border-neutral-300 rounded-md md:w-auto",children:[e.jsx(H,{size:18}),b?"Hide Filters":"Show Filters"]})]}),b&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-200",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Category"}),e.jsx("select",{value:p,onChange:t=>j(t.target.value),className:"w-full px-3 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",children:h.map(t=>e.jsx("option",{value:t==="All"?"":t,children:t},t))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{y(""),j("")},className:"flex items-center text-neutral-600 hover:text-neutral-800",children:[e.jsx(S,{size:16,className:"mr-1"})," Clear Filters"]})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:a?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{children:"Loading products..."})}):u.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 text-sm text-neutral-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Image"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Featured"}),e.jsx("th",{className:"px-6 py-3 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:u.map(t=>e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-12 h-12 object-cover rounded"})}),e.jsx("td",{className:"px-6 py-4 font-medium text-secondary-500",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-neutral-600",children:t.category}),e.jsxs("td",{className:"px-6 py-4 text-neutral-600",children:["â‚¹",t.price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.stock>20?"bg-success-100 text-success-700":t.stock>10?"bg-warning-100 text-warning-700":"bg-error-100 text-error-700"}`,children:t.stock})}),e.jsx("td",{className:"px-6 py-4 text-neutral-600",children:t.featured?"Yes":"No"}),e.jsxs("td",{className:"px-6 py-4 text-right space-x-1",children:[e.jsx("button",{className:"p-1 text-neutral-500 hover:text-primary-500",title:"View Product",onClick:()=>q(t.id),children:e.jsx(J,{size:18})}),e.jsx("button",{className:"p-1 text-neutral-500 hover:text-secondary-500",title:"Edit Product",onClick:()=>L(t),children:e.jsx($,{size:18})}),e.jsx("button",{className:"p-1 text-neutral-500 hover:text-error-500",title:"Delete Product",onClick:()=>N(t.id),children:e.jsx(W,{size:18})})]})]},t.id))})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-neutral-600",children:"No products found matching your criteria."})})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-neutral-500",children:["Showing ",u.length," of ",x.length," products"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-1 border border-neutral-300 rounded-md text-neutral-600 hover:bg-neutral-50",children:"Previous"}),e.jsx("button",{className:"px-3 py-1 bg-primary-500 text-secondary-500 rounded-md",children:"1"}),e.jsx("button",{className:"px-3 py-1 border border-neutral-300 rounded-md text-neutral-600 hover:bg-neutral-50",children:"Next"})]})]}),c&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-secondary-500 bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center text-error-500 mb-4",children:[e.jsx(X,{size:24,className:"mr-2"}),e.jsx("h3",{className:"text-lg font-medium",children:"Confirm Deletion"})]}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this product? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>N(null),className:"px-4 py-2 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50",children:"Cancel"}),e.jsx("button",{onClick:()=>c&&o(c),className:"px-4 py-2 bg-error-500 text-white rounded-md hover:bg-error-600",children:"Delete"})]})]})}),e.jsx(Q,{isOpen:g,onClose:()=>f(!1),onSuccess:C}),r&&e.jsx(Z,{isOpen:P,onClose:()=>{v(!1),s(null)},onSuccess:()=>{v(!1),s(null),window.location.reload()},product:r})]})]})};export{he as default};
//# sourceMappingURL=ProductsPage-DLNSoJh4.js.map
