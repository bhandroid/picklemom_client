import{c as P,r as a,j as e,X as k,e as E,d as U,f as V}from"./index-BbHmWxeT.js";import{H as z}from"./Helmet-BbXNZb2X.js";import{A as O}from"./AdminLayout-BCjfDwtc.js";import{B as w}from"./Button-DmSsJSq7.js";import{c as q,t as M,d as _}from"./promos-ZGzVUqs4.js";import{P as $}from"./plus-CsmrkZlX.js";import{S as H}from"./search--fvj5Q_h.js";import{F as I,S as R}from"./square-pen-BF1IVFps.js";import{T as B}from"./trash-2-CACjRIer.js";import{A as X}from"./alert-circle-BQfkHlz4.js";import"./package-RgcQhqxj.js";import"./tag-CJLCSPUx.js";import"./users-CoztkOlz.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=P("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=P("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),K=({isOpen:x,onClose:p,onSuccess:h})=>{const[r,v]=a.useState(!1),[f,l]=a.useState(null),[s,c]=a.useState({code:"",description:"",discountType:"percentage",discountValue:"",minimumOrderAmount:"",maximumDiscountAmount:"",usageLimit:"",isActive:!0,validFrom:"",validUntil:""}),i=o=>{const{name:d,value:j,type:b}=o.target;c(y=>({...y,[d]:b==="checkbox"?o.target.checked:j})),l(null)},m=async o=>{o.preventDefault(),v(!0),l(null);try{if(!s.code.trim())throw new Error("Promo code is required");if(!s.discountValue||parseFloat(s.discountValue)<=0)throw new Error("Please enter a valid discount value");if(!s.validFrom||!s.validUntil)throw new Error("Please select valid from and until dates");if(new Date(s.validFrom)>=new Date(s.validUntil))throw new Error("Valid until date must be after valid from date");const d={code:s.code.trim().toUpperCase(),description:s.description.trim()||void 0,discountType:s.discountType,discountValue:parseFloat(s.discountValue),minimumOrderAmount:s.minimumOrderAmount?parseFloat(s.minimumOrderAmount):0,maximumDiscountAmount:s.maximumDiscountAmount?parseFloat(s.maximumDiscountAmount):void 0,usageLimit:s.usageLimit?parseInt(s.usageLimit):void 0,isActive:s.isActive,validFrom:s.validFrom,validUntil:s.validUntil};await q(d),c({code:"",description:"",discountType:"percentage",discountValue:"",minimumOrderAmount:"",maximumDiscountAmount:"",usageLimit:"",isActive:!0,validFrom:"",validUntil:""}),h(),p()}catch(d){console.error("Error adding promo code:",d),l(d.message||"Failed to add promo code. Please try again.")}finally{v(!1)}},g=()=>{r||(l(null),p())};return x?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-secondary-500 bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200",children:[e.jsx("h2",{className:"text-xl font-serif font-bold text-secondary-500",children:"Add New Promo Code"}),e.jsx("button",{onClick:g,disabled:r,className:"text-neutral-500 hover:text-neutral-700 disabled:opacity-50",children:e.jsx(k,{size:24})})]}),f&&e.jsx("div",{className:"mx-6 mt-4 p-4 bg-error-50 border border-error-200 rounded-md",children:e.jsx("p",{className:"text-error-700 text-sm",children:f})}),e.jsxs("form",{onSubmit:m,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Promo Code *"}),e.jsx("input",{type:"text",name:"code",value:s.code,onChange:i,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300 uppercase",placeholder:"SAVE20",required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Discount Type *"}),e.jsxs("select",{name:"discountType",value:s.discountType,onChange:i,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:r,children:[e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"fixed",children:"Fixed Amount"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:["Discount Value * ",s.discountType==="percentage"?"(%)":"(₹)"]}),e.jsx("input",{type:"number",name:"discountValue",value:s.discountValue,onChange:i,step:s.discountType==="percentage"?"1":"0.01",min:"0",max:s.discountType==="percentage"?"100":void 0,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Minimum Order Amount (₹)"}),e.jsx("input",{type:"number",name:"minimumOrderAmount",value:s.minimumOrderAmount,onChange:i,step:"0.01",min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",disabled:r})]}),s.discountType==="percentage"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Maximum Discount Amount (₹)"}),e.jsx("input",{type:"number",name:"maximumDiscountAmount",value:s.maximumDiscountAmount,onChange:i,step:"0.01",min:"0",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Usage Limit"}),e.jsx("input",{type:"number",name:"usageLimit",value:s.usageLimit,onChange:i,min:"1",className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",placeholder:"Unlimited",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Valid From *"}),e.jsx("input",{type:"datetime-local",name:"validFrom",value:s.validFrom,onChange:i,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Valid Until *"}),e.jsx("input",{type:"datetime-local",name:"validUntil",value:s.validUntil,onChange:i,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",required:!0,disabled:r})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:s.description,onChange:i,rows:3,className:"w-full px-4 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",placeholder:"Optional description for the promo code",disabled:r})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:s.isActive,onChange:i,disabled:r,className:"h-4 w-4 text-primary-500 focus:ring-primary-300 border-neutral-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-neutral-700",children:"Active"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:g,disabled:r,children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",disabled:r,children:r?"Adding Promo Code...":"Add Promo Code"})]})]})]})}):null},de=()=>{const{user:x}=E(),p=U(),[h,r]=a.useState([]),[v,f]=a.useState(!0),[l,s]=a.useState(""),[c,i]=a.useState(!1),[m,g]=a.useState(""),[o,d]=a.useState([]),[j,b]=a.useState(null),[y,C]=a.useState(!1);a.useEffect(()=>{x&&!x.isAdmin&&p("/")},[x,p]),a.useEffect(()=>{A()},[]),a.useEffect(()=>{let t=[...h];l&&(t=t.filter(n=>{var u;return n.code.toLowerCase().includes(l.toLowerCase())||((u=n.description)==null?void 0:u.toLowerCase().includes(l.toLowerCase()))})),m!==""&&(t=t.filter(n=>n.isActive===(m==="active"))),d(t)},[h,l,m]);const A=async()=>{try{f(!0);const t=await V.getPromoCodes();t.success&&t.data&&r(t.data)}catch(t){console.error("Error fetching promo codes:",t)}finally{f(!1)}},F=async t=>{try{await _(t),r(n=>n.filter(u=>u._id!==t)),b(null)}catch(n){console.error("Error deleting promo code:",n),alert("Failed to delete promo code. Please try again.")}},D=async t=>{try{const n=await M(t);r(u=>u.map(S=>S._id===t?n:S))}catch(n){console.error("Error toggling promo code status:",n),alert("Failed to toggle promo code status. Please try again.")}},T=()=>{A()},L=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=t=>new Date(t)<new Date;return e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx("title",{children:"Manage Promo Codes | The Pickle Mom Admin"})}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-2xl font-serif font-bold text-secondary-500",children:"Promo Codes"}),e.jsxs(w,{variant:"primary",onClick:()=>C(!0),children:[e.jsx($,{size:16,className:"mr-2"})," Add New Promo Code"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Search promo codes...",value:l,onChange:t=>s(t.target.value),className:"w-full px-4 py-2 pl-10 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300"}),e.jsx(H,{className:"absolute left-3 top-2.5 text-neutral-400",size:18})]}),e.jsxs("button",{onClick:()=>i(!c),className:"flex items-center justify-center gap-2 px-4 py-2 border border-neutral-300 rounded-md md:w-auto",children:[e.jsx(I,{size:18}),c?"Hide Filters":"Show Filters"]})]}),c&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-200",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Status"}),e.jsxs("select",{value:m,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 rounded-md border border-neutral-300 focus:outline-none focus:ring-2 focus:ring-primary-300",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:()=>{s(""),g("")},className:"flex items-center text-neutral-600 hover:text-neutral-800",children:[e.jsx(k,{size:16,className:"mr-1"})," Clear Filters"]})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:v?e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{children:"Loading promo codes..."})}):o.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 text-sm text-neutral-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Usage"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Valid Until"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsxs("td",{className:"px-6 py-4 font-medium text-secondary-500",children:[t.code,t.description&&e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:t.description})]}),e.jsx("td",{className:"px-6 py-4 text-neutral-600",children:t.discountType==="percentage"?"Percentage":"Fixed Amount"}),e.jsx("td",{className:"px-6 py-4 text-neutral-600",children:t.discountType==="percentage"?`${t.discountValue}%`:`₹${t.discountValue}`}),e.jsxs("td",{className:"px-6 py-4 text-neutral-600",children:[t.usedCount," / ",t.usageLimit||"∞"]}),e.jsx("td",{className:"px-6 py-4 text-neutral-600",children:e.jsx("span",{className:N(t.validUntil)?"text-error-500":"",children:L(t.validUntil)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>D(t._id),className:`mr-2 ${t.isActive?"text-success-500":"text-neutral-400"}`,title:`Click to ${t.isActive?"deactivate":"activate"}`,children:t.isActive?e.jsx(J,{size:20}):e.jsx(G,{size:20})}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.isActive&&!N(t.validUntil)?"bg-success-100 text-success-700":"bg-neutral-100 text-neutral-700"}`,children:t.isActive&&!N(t.validUntil)?"Active":"Inactive"})]})}),e.jsxs("td",{className:"px-6 py-4 text-right space-x-1",children:[e.jsx("button",{className:"p-1 text-neutral-500 hover:text-secondary-500",title:"Edit Promo Code",children:e.jsx(R,{size:18})}),e.jsx("button",{className:"p-1 text-neutral-500 hover:text-error-500",title:"Delete Promo Code",onClick:()=>b(t._id),children:e.jsx(B,{size:18})})]})]},t._id))})]}):e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-neutral-600",children:"No promo codes found matching your criteria."})})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"text-sm text-neutral-500",children:["Showing ",o.length," of ",h.length," promo codes"]})}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-secondary-500 bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center text-error-500 mb-4",children:[e.jsx(X,{size:24,className:"mr-2"}),e.jsx("h3",{className:"text-lg font-medium",children:"Confirm Deletion"})]}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this promo code? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>b(null),className:"px-4 py-2 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50",children:"Cancel"}),e.jsx("button",{onClick:()=>j&&F(j),className:"px-4 py-2 bg-error-500 text-white rounded-md hover:bg-error-600",children:"Delete"})]})]})}),e.jsx(K,{isOpen:y,onClose:()=>C(!1),onSuccess:T})]})]})};export{de as default};
//# sourceMappingURL=PromoCodesPage-CEJ24mjr.js.map
